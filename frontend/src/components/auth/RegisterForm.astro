---
// RegisterForm component
---
<form id="register-form" class="space-y-4 max-w-lg mx-auto">
  <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded"></div>
  <div id="success-message" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded"></div>
  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="username" class="block text-sm font-medium text-gray-700">Nombre de Usuario *</label>
      <input 
        type="text" 
        id="username" 
        name="username" 
        required 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
        placeholder="usuario123"
      />
    </div>
    <div>
      <label for="email" class="block text-sm font-medium text-gray-700">Email *</label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        required 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
        placeholder="correo@empresa.cl"
      />
    </div>
  </div>

  <div>
    <label for="password" class="block text-sm font-medium text-gray-700">Contraseña *</label>
    <input 
      type="password" 
      id="password" 
      name="password" 
      required 
      minlength="6"
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
      placeholder="Mínimo 6 caracteres"
    />
  </div>

  <hr class="my-4" />
  <h3 class="text-lg font-semibold text-gray-700">Datos de Facturación</h3>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label for="rut" class="block text-sm font-medium text-gray-700">RUT *</label>
      <input 
        type="text" 
        id="rut" 
        name="rut" 
        required 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
        placeholder="12.345.678-9"
      />
    </div>
    <div>
      <label for="telefono" class="block text-sm font-medium text-gray-700">Teléfono *</label>
      <input 
        type="tel" 
        id="telefono" 
        name="telefono" 
        required 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
        placeholder="+56 9 1234 5678"
      />
    </div>
  </div>

  <div>
    <label for="razon_social" class="block text-sm font-medium text-gray-700">Razón Social *</label>
    <input 
      type="text" 
      id="razon_social" 
      name="razon_social" 
      required 
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
      placeholder="Empresa SpA"
    />
  </div>

  <div>
    <label for="giro" class="block text-sm font-medium text-gray-700">Giro *</label>
    <input 
      type="text" 
      id="giro" 
      name="giro" 
      required 
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
      placeholder="Venta de productos de limpieza"
    />
  </div>

  <div>
    <label for="direccion" class="block text-sm font-medium text-gray-700">Dirección *</label>
    <input 
      type="text" 
      id="direccion" 
      name="direccion" 
      required 
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
      placeholder="Calle 123, Comuna, Ciudad"
    />
  </div>

  <div>
    <label for="tipo_persona" class="block text-sm font-medium text-gray-700">Tipo de Persona *</label>
    <select 
      id="tipo_persona" 
      name="tipo_persona" 
      required
      class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 px-3 py-2 border"
    >
      <option value="">Seleccione...</option>
      <option value="Natural">Persona Natural</option>
      <option value="Empresa">Empresa</option>
    </select>
  </div>

  <div class="bg-yellow-50 border border-yellow-200 rounded p-3 text-sm text-yellow-800">
    <strong>Nota:</strong> Después de registrarte, tu cuenta quedará pendiente de validación por un administrador. 
    Una vez aprobada, podrás ver los precios y realizar pedidos.
  </div>

  <button 
    type="submit" 
    id="submit-btn"
    class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded hover:bg-blue-700 transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed"
  >
    Registrarse
  </button>
</form>

<script>
  const form = document.getElementById('register-form') as HTMLFormElement;
  const errorDiv = document.getElementById('error-message');
  const successDiv = document.getElementById('success-message');
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    // Disable button while processing
    submitBtn.disabled = true;
    submitBtn.textContent = 'Registrando...';
    errorDiv?.classList.add('hidden');
    successDiv?.classList.add('hidden');

    try {
      const res = await fetch('/api/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      const responseData = await res.json();

      if (!res.ok) {
        throw new Error(responseData.error || 'Error al registrarse');
      }

      // Show success message
      if (successDiv) {
        successDiv.innerHTML = `
          <strong>¡Registro exitoso!</strong><br>
          Tu cuenta ha sido creada y está pendiente de validación.<br>
          Te notificaremos cuando sea aprobada.
        `;
        successDiv.classList.remove('hidden');
      }
      
      // Reset form
      form.reset();
      
      // Redirect after a delay
      setTimeout(() => {
        window.location.href = '/login';
      }, 3000);

    } catch (error: any) {
      if (errorDiv) {
        errorDiv.textContent = error.message || 'Error al registrarse';
        errorDiv.classList.remove('hidden');
      }
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Registrarse';
    }
  });
</script>
